# s21_decimal

Библиотека, переосмысливающая десятичный тип фиксированной точности, аналогичный семантике, принятой в банковском ПО. Предоставляет арифметические, сравнительные, конвертационные и округляющие помощники поверх 128-битного контейнера, который хранит 96-битную мантиссу, флаг знака и десятичный масштаб.

## Возможности
- Структура `s21_decimal` с помощниками для сброса состояния, изменения масштаба и побитового доступа.
- Арифметика: `s21_add`, `s21_sub`, `s21_mul`, `s21_div` с обработкой переполнений и деления на ноль.
- Сравнение: полный набор функций упорядочивания плюс `is_equal`/`is_not_equal`.
- Конвертация: преобразования из целых чисел и чисел с плавающей точкой формата IEEE-754 одинарной точности.
- Округление: `s21_truncate`, `s21_floor`, `s21_round`, `s21_negate`.
- Расширенные утилиты `big_decimal` для повышенной промежуточной точности вычислений.

## Структура репозитория
- `src/s21_decimal.h` — публичный API.
- `src/components/` — реализация, разбитая по функциональным областям.
- `src/tests/` — модульные тесты на базе фреймворка Check (`Suite`-раннеры в `test.c`).
- `src/html_report/` — HTML-отчеты по покрытию, создаваемые командой `make gcov_report`.

## Зависимости
- `gcc` с поддержкой C11
- `make`
- [`check`](https://libcheck.github.io/check/) — библиотека модульного тестирования
- `lcov` и `genhtml` для отчетов по покрытию (опционально)
- `valgrind` для поиска утечек памяти (опционально)
- `clang-format` (опционально, для форматирования)
- `cppcheck` (опционально, для статического анализа)

Установите пакеты через менеджер пакетов вашей системы. Для Ubuntu-подобных дистрибутивов:

```sh
sudo apt-get install build-essential check lcov valgrind clang-format cppcheck
```

## Сборка
Все сборочные сценарии находятся в `src/`.

```sh
cd src
make            # соберет статическую библиотеку s21_decimal.a в src/
```

Команда `make clean` удаляет артефакты сборки (`build/`, `obj_test/`, `compiled_tests/`, бинарные файлы и отчеты покрытия).

## Запуск тестов
Модульные тесты написаны с использованием Check и запускаются через Makefile:

```sh
cd src
make test          # сборка и запуск модульных тестов
make gcov_report   # тесты + генерация html_report/ через lcov/genhtml
make valgrind      # запуск тестов под Valgrind (требуется CK_FORK=no)
make debug         # сборка тестового бинарного файла с отладочными символами
```

Тестовый раннер собирает тестовые наборы из `tests/test_*.c`; каждый набор выводит информацию об успехах и ошибках в stdout.

## Форматирование и статический анализ

```sh
cd src
make format        # запуск clang-format в режиме dry-run (требуется .clang-format)
make format-fix    # применение clang-format к исходникам
make cppcheck      # запуск cppcheck с строгими флагами для компонентов и тестов
```

## Использование библиотеки
Соберите свой проект с `s21_decimal.a` и подключите публичный заголовок:

```c
#include "s21_decimal.h"

int main(void) {
  s21_decimal price = {{0}};
  s21_from_int_to_decimal(1250, &price);  // 1250
  setScale(&price, 2);                    // трактуем как 12.50

  s21_decimal tax = {{0}};
  s21_from_float_to_decimal(0.66f, &tax);

  s21_decimal total = {{0}};
  if (s21_add(price, tax, &total) == ADD_OK) {
    float as_float = 0.0f;
    s21_from_decimal_to_float(total, &as_float);  // 13.16
  }
  return 0;
}
```

Все арифметические функции автоматически нормализуют масштаб и возвращают коды состояния:
- `ADD_OK`
- `NUMBER_TOO_LARGE`
- `NUMBER_TOO_SMALL`
- `DIVISION_BY_ZERO`

## Десятичное представление
- Мантисса: 96 бит, хранящиеся в `bits[0..2]`
- Знак: старший бит `bits[3]` (`MINUS_BIT_INDEX`)
- Масштаб: 8-битное значение в `bits[3]` (показатель степени по основанию 10)
- Внутренние помощники опираются на `big_decimal`, чтобы избежать переполнения на промежуточных шагах.

Полный список API и используемых констант см. в `src/s21_decimal.h`.
